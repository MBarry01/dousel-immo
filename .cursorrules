# R√®gles Cursor pour Doussel Immo

## üö® PRIORIT√â ABSOLUE : √âVITER LES DUPLICATIONS

### Avant TOUTE modification de fichier :
1. **TOUJOURS** lire le fichier en entier avec `read_file` avant d'√©diter
2. **V√âRIFIER** qu'il n'y a pas d√©j√† de duplication existante
3. **NE JAMAIS** ajouter de code apr√®s la derni√®re accolade fermante `}` d'un fichier
4. **TOUJOURS** utiliser `search_replace` avec un contexte suffisant (5+ lignes avant/apr√®s)
5. **V√âRIFIER** que le contenu √† remplacer est unique dans le fichier

### D√©tection de duplication :
- Si un fichier se termine par du code orphelin (fonctions, imports, types sans contexte), c'est une duplication
- Si des imports ou des d√©clarations apparaissent 2 fois, c'est une duplication
- **JAMAIS** de code apr√®s la derni√®re fonction/export du fichier

### En cas de duplication d√©tect√©e :
1. Supprimer IMM√âDIATEMENT tout le code dupliqu√©
2. Ne garder QUE la premi√®re occurrence compl√®te et correcte
3. V√©rifier que le fichier se termine proprement (derni√®re `}` suivie d'un seul saut de ligne)

---

## üìê STRUCTURE DE CODE

### TypeScript/Next.js :
- Toujours typer explicitement les param√®tres et retours de fonction
- Utiliser `interface` pour les objets, `type` pour les unions/intersections
- Exporter les types utilis√©s dans plusieurs fichiers
- Pr√©f√©rer les exports nomm√©s aux exports par d√©faut (sauf pour les pages Next.js)

### Commentaires JSDoc :
```typescript
/**
 * Description de la fonction
 * @param paramName - Description du param√®tre
 * @returns Description du retour
 */
```
- **TOUJOURS** commencer par `/**` (JAMAIS juste `*`)
- **TOUJOURS** terminer par `*/` sur une nouvelle ligne

### Composants React :
- Toujours d√©finir une interface pour les props
- V√©rifier que les props pass√©es correspondent √† l'interface
- Ne jamais ajouter de props non d√©finies dans l'interface
- Utiliser `"use client"` uniquement si n√©cessaire (hooks, √©v√©nements, √©tat)

---

## üîß CONFIGURATION

### tsconfig.json :
- Exclure `node_modules`, `supabase/functions`, et `scripts` de la compilation
- Ne JAMAIS compiler les scripts utilitaires avec le build de production

### Fichiers √† NE JAMAIS modifier automatiquement :
- `.env` et `.env.local` (demander confirmation √† l'utilisateur)
- `package.json` (sauf ajout de d√©pendances explicitement demand√©)
- Configuration de base (tsconfig, next.config, tailwind.config)

---

## üéØ WORKFLOW DE MODIFICATION

### Pour CHAQUE modification :
1. **LIRE** le fichier complet avec `read_file`
2. **COMPRENDRE** la structure et le contexte
3. **LOCALISER** pr√©cis√©ment la section √† modifier
4. **UTILISER** `search_replace` avec un contexte suffisant (pas de placeholders)
5. **V√âRIFIER** qu'il n'y a pas de duplication apr√®s modification
6. **TESTER** avec `npm run build` si modification importante

### En cas d'erreur de build :
1. Lire le message d'erreur COMPLET
2. Identifier le fichier et la ligne exacte
3. Lire le fichier complet pour comprendre le contexte
4. Corriger UNIQUEMENT l'erreur identifi√©e (pas de refactoring suppl√©mentaire)
5. Re-v√©rifier avec `npm run build`

---

## üõ†Ô∏è OUTILS ET COMMANDES

### Pr√©f√©rer dans cet ordre :
1. `read_file` - Pour comprendre le code existant
2. `grep` - Pour rechercher des patterns ou symboles exacts
3. `codebase_search` - Pour recherche s√©mantique ("comment fonctionne X?")
4. `search_replace` - Pour modification pr√©cise avec contexte
5. `run_terminal_cmd` - En dernier recours uniquement

### Commandes PowerShell (Windows) :
- Pour compter les lignes : `powershell -Command "Get-Content 'fichier.ts' | Measure-Object -Line"`
- Pour tronquer un fichier : `powershell -Command "(Get-Content 'fichier.ts' | Select-Object -First N) | Set-Content 'fichier.ts'"`

---

## üì¶ D√âPENDANCES ET IMPORTS

### Ordre des imports :
1. React et Next.js
2. Biblioth√®ques tierces
3. Imports locaux (@/...)
4. Types et interfaces
5. CSS/Styles

### √âviter :
- Les imports circulaires
- Les imports non utilis√©s
- Les imports dynamiques sans raison (utiliser statique par d√©faut)

---

## üîí S√âCURIT√â

### Variables d'environnement :
- **JAMAIS** exposer de cl√©s secr√®tes dans le code
- Utiliser `NEXT_PUBLIC_` uniquement pour les variables c√¥t√© client
- Toujours v√©rifier l'existence des variables avant utilisation

### Validation :
- Toujours valider les entr√©es utilisateur
- Utiliser les Server Actions pour les op√©rations sensibles
- Ne JAMAIS faire confiance aux donn√©es client

---

## üé® CONVENTIONS DE NOMMAGE

### Fichiers :
- Composants React : `PascalCase.tsx`
- Utilitaires : `kebab-case.ts`
- Pages Next.js : `kebab-case` (dossiers) ou `page.tsx`
- Server Actions : `actions.ts`

### Variables :
- Composants : `PascalCase`
- Fonctions : `camelCase`
- Constantes : `SCREAMING_SNAKE_CASE`
- Types/Interfaces : `PascalCase`

### Fonctions :
- Server Actions : pr√©fixer avec le verbe (create, update, delete, get)
- Event handlers : pr√©fixer avec `handle` (handleClick, handleSubmit)
- Utilitaires : verbes descriptifs (formatDate, validateEmail)

---

## üìù MESSAGES DE COMMIT (si demand√©)

### Format :
```
type(scope): description courte

- D√©tail 1
- D√©tail 2
```

### Types :
- `fix:` - Correction de bug
- `feat:` - Nouvelle fonctionnalit√©
- `refactor:` - Refactoring sans changement de fonctionnalit√©
- `docs:` - Documentation
- `style:` - Formatage, pas de changement de code
- `perf:` - Am√©lioration de performance
- `test:` - Ajout/modification de tests
- `build:` - Changements de build ou d√©pendances
- `ci:` - Changements CI/CD

---

## ‚ö° PERFORMANCE

### Optimisations :
- Utiliser `use server` pour les Server Actions
- Utiliser `use client` uniquement si n√©cessaire
- Lazy loading pour les composants lourds
- Images optimis√©es avec `next/image`
- Pr√©f√©rer les Server Components quand possible

### √Ä √©viter :
- Fetch c√¥t√© client si possible c√¥t√© serveur
- Re-renders inutiles (utiliser `memo`, `useMemo`, `useCallback` judicieusement)
- Bundles trop larges (v√©rifier avec `npm run build`)

---

## üß™ TESTS ET DEBUGGING

### Avant de pousser du code :
1. `npm run build` - TOUJOURS v√©rifier que le build passe
2. Tester manuellement les fonctionnalit√©s modifi√©es
3. V√©rifier les logs dans la console (pas d'erreurs)
4. Tester sur mobile si modifications UI

### Logs de debugging :
- Utiliser des emojis pour faciliter la lecture (üîç üö® ‚úÖ ‚ùå üìß etc.)
- Toujours pr√©fixer avec le contexte
- Supprimer les logs de debug avant production (sauf erreurs critiques)

---

## üöÄ D√âPLOIEMENT

### Checklist avant d√©ploiement :
- [ ] Build passe sans erreur (`npm run build`)
- [ ] Pas de console.log de debug
- [ ] Variables d'environnement configur√©es sur Vercel
- [ ] Tests manuels effectu√©s
- [ ] Pas de TODO critique dans le code
- [ ] Documentation √† jour si n√©cessaire

---

## üí° PRINCIPES G√âN√âRAUX

1. **DRY (Don't Repeat Yourself)** - Ne jamais dupliquer du code
2. **KISS (Keep It Simple, Stupid)** - Pr√©f√©rer la simplicit√© √† la complexit√©
3. **YAGNI (You Aren't Gonna Need It)** - Ne pas anticiper les besoins futurs
4. **Separation of Concerns** - Chaque fichier/fonction a une responsabilit√© claire
5. **Fail Fast** - Valider t√¥t, √©chouer t√¥t si quelque chose ne va pas
6. **Read Before Write** - TOUJOURS lire avant de modifier

---

## üÜò EN CAS DE PROBL√àME

### Si le build √©choue :
1. Lire le message d'erreur COMPLET
2. Ne pas paniquer et corriger plusieurs choses √† la fois
3. Corriger UNE erreur √† la fois
4. Re-build apr√®s chaque correction
5. Si erreur de duplication : chercher avec grep le symbole dupliqu√© et supprimer la duplication

### Si comportement inattendu :
1. V√©rifier les logs console (navigateur ET terminal)
2. V√©rifier les variables d'environnement
3. V√©rifier la configuration Supabase (RLS, SMTP, etc.)
4. Tester en isolation (cr√©er un test minimal)

